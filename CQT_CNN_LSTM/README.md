
# ğŸ’¤ Audio-based Snore Detection (CQT + CNN-LSTM)

æœ¬é¡¹ç›®å¤ç°è®ºæ–‡  
> **Xie et al. (2021). Audio-based snore detection using deep neural networks.**  
> *Computer Methods and Programs in Biomedicine, 200:105833.*

è¯¥ç³»ç»Ÿé€šè¿‡ **Constant-Q Transform (CQT)** æå–é¼¾å£°ç‰¹å¾ï¼Œå¹¶åˆ©ç”¨ **CNN+LSTM ç½‘ç»œ** å¯¹éŸ³é¢‘ç‰‡æ®µè¿›è¡Œé¼¾å£°è¯†åˆ«ã€‚  
æ•´ä¸ªæµç¨‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š  
éŸ³é¢‘é¢„å¤„ç† â†’ ç‰¹å¾å¯è§†åŒ– â†’ ç¥ç»ç½‘ç»œè®­ç»ƒã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```

snore_detection/
â”‚
â”œâ”€â”€ data/                 # åŸå§‹éŸ³é¢‘ (.wav)
â”œâ”€â”€ features/             # é¢„å¤„ç†åä¿å­˜çš„ CQT è°±å›¾ (.npy)
â”œâ”€â”€ spectrograms/         # å¯è§†åŒ–è¾“å‡ºçš„è°±å›¾ (.png)
â”‚
â”œâ”€â”€ preprocess_snore.py   # éŸ³é¢‘é¢„å¤„ç†è„šæœ¬ï¼ˆç”ŸæˆCQTè°±å›¾ï¼‰
â”œâ”€â”€ train_cnn_lstm.py     # CNN+LSTM æ¨¡å‹è®­ç»ƒè„šæœ¬
â””â”€â”€ visualize_cqt.py      # å¯è§†åŒ–è„šæœ¬ï¼ˆæ³¢å½¢ + é¢‘è°±å›¾ï¼‰

```

---

## ğŸ§© ç¯å¢ƒä¾èµ–

è¯·å…ˆå®‰è£…ä»¥ä¸‹ä¾èµ–åº“ï¼š

```bash
pip install numpy librosa torch matplotlib
````

å¯é€‰ä¾èµ–ï¼ˆç”¨äºç»˜åˆ¶éŸ³é¢‘è°±å›¾æ—¶çš„æ˜¾ç¤ºï¼‰ï¼š

```bash
pip install soundfile
```

```bash 
pip install pydub
```

---

## ğŸ§ 1ï¸âƒ£ é¢„å¤„ç†è„šæœ¬ï¼š`preprocess_snore.py`

**åŠŸèƒ½ï¼š**
å°†åŸå§‹ `.wav` éŸ³é¢‘è½¬ä¸ºæ ‡å‡†åŒ–çš„ **CQT é¢‘è°±å›¾ï¼ˆ.npyï¼‰** æ–‡ä»¶ã€‚

**ä¸»è¦å¤„ç†æµç¨‹ï¼š**

1. åŠ è½½éŸ³é¢‘ï¼ˆé‡‡æ ·ç‡ `48 kHz`ï¼‰ï¼›
2. æˆªå–/è¡¥é›¶ä¸ºå›ºå®šé•¿åº¦ï¼ˆ3.5 sï¼‰ï¼›
3. è¿›è¡Œ50 Hzé«˜é€šå»å™ªï¼›
4. è®¡ç®— CQT è°±å›¾ï¼ˆ84ä¸ªé¢‘ç‡binï¼Œ12 bin/octaveï¼‰ï¼›
5. è½¬æ¢ä¸ºå¯¹æ•°åŠŸç‡è°±å¹¶å½’ä¸€åŒ–ï¼›
6. ä¿å­˜ä¸º `.npy` æ•°ç»„ã€‚

**è¿è¡Œç¤ºä¾‹ï¼š**

```bash
python preprocess_snore.py
```

æ‰§è¡Œåï¼Œç¨‹åºä¼šè‡ªåŠ¨å¤„ç† `data/` æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ `.wav` æ–‡ä»¶ï¼Œ
å¹¶åœ¨ `features/` æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆå¯¹åº”çš„ `.npy` æ–‡ä»¶ã€‚

**ç¤ºä¾‹è¾“å‡ºï¼š**

```
features/snore_01.npy
features/non_snore_02.npy
```

---

## ğŸ§  2ï¸âƒ£ è®­ç»ƒè„šæœ¬ï¼š`train_cnn_lstm.py`

**åŠŸèƒ½ï¼š**
ä½¿ç”¨ CNN + LSTM æ¨¡å‹å¯¹ CQT ç‰¹å¾è¿›è¡Œè®­ç»ƒï¼Œå®ç°é¼¾å£°åˆ†ç±»ã€‚

**æ¨¡å‹ç»“æ„ï¼š**

* 3 å±‚ CNNï¼ˆå·ç§¯æ ¸ 8Ã—2ï¼ŒReLU + MaxPooling + Dropoutï¼‰
* 1 å±‚ LSTMï¼ˆhidden size = 64ï¼‰
* 1 å±‚å…¨è¿æ¥ + Softmax è¾“å‡ºå±‚

**è®­ç»ƒå‚æ•°ï¼š**

| å‚æ•°            | å€¼                |
| ------------- | ---------------- |
| Batch size    | 64               |
| Optimizer     | Adam             |
| Learning rate | 0.001            |
| Epochs        | 100              |
| Loss          | CrossEntropyLoss |

**è¿è¡Œç¤ºä¾‹ï¼š**

```bash
python train_cnn_lstm.py
```

**è¾“å‡ºï¼š**

* è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±å€¼ï¼›
* æ¨¡å‹å‚æ•°æ–‡ä»¶ï¼š

  ```
  snore_cnn_lstm.pth
  ```

---

## ğŸ¨ 3ï¸âƒ£ å¯è§†åŒ–è„šæœ¬ï¼š`visualize_cqt.py`

**åŠŸèƒ½ï¼š**
å¯åŒæ—¶æ˜¾ç¤ºï¼š

* éŸ³é¢‘æ³¢å½¢ï¼›
* CQT é¢‘è°±å›¾ï¼ˆdBæ ‡åº¦ï¼‰ï¼›
* å¹¶å°†ç»“æœä¿å­˜ä¸º `.png` å›¾åƒã€‚

**è¿è¡Œç¤ºä¾‹ï¼š**

```bash
python visualize_cqt.py
```

ç¨‹åºä¼šè‡ªåŠ¨è¯»å–ï¼š

* `features/` ä¸‹çš„ç¬¬ä¸€ä¸ª `.npy` æ–‡ä»¶ï¼›
* `data/` ä¸‹åŒå `.wav` æ–‡ä»¶ï¼›
  å¹¶è¾“å‡ºåˆ°ï¼š

```
spectrograms/
```

**ç¤ºä¾‹è¾“å‡ºï¼š**

```
spectrograms/snore_01.png
```

**å›¾åƒå†…å®¹ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Waveform (Time)       â”‚ â† ä¸Šï¼šåŸå§‹æ³¢å½¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      CQT Spectrogram (dB)   â”‚ â† ä¸‹ï¼šå¯¹åº”é¢‘è°±å›¾
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ å‚æ•°è®¾ç½®

| å‚æ•°                | æ–‡ä»¶                  | é»˜è®¤å€¼   | è¯´æ˜          |
| ----------------- | ------------------- | ----- | ----------- |
| `sr`              | preprocess_snore.py | 48000 | é‡‡æ ·ç‡ï¼ˆHzï¼‰     |
| `duration`        | preprocess_snore.py | 3.5   | æ¯ä¸ªç‰‡æ®µé•¿åº¦ï¼ˆç§’ï¼‰   |
| `n_bins`          | preprocess_snore.py | 84    | CQT é¢‘ç‡binæ•°é‡ |
| `bins_per_octave` | preprocess_snore.py | 12    | æ¯å€é¢‘ç¨‹åˆ†è¾¨ç‡     |
| `hop_length`      | preprocess_snore.py | 512   | å¸§ç§»é•¿åº¦        |
| `hidden_size`     | train_cnn_lstm.py   | 64    | LSTMéšè—å±‚å¤§å°   |

---

## ğŸ“Š æ•°æ®å‘½åçº¦å®š

ä¸ºäº†è®©è„šæœ¬è‡ªåŠ¨è¯†åˆ«ç±»åˆ«ï¼Œè¯·å°†éŸ³é¢‘å‘½åä¸ºï¼š

```
snore_01.wav
snore_02.wav
non_snore_01.wav
...
```

è„šæœ¬ä¼šæ ¹æ®æ–‡ä»¶åè‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾ï¼š

* åŒ…å« `snore` â†’ æ ‡ç­¾ `1`
* åŒ…å« `non_snore` â†’ æ ‡ç­¾ `0`

---

## ğŸ§© æ–‡ä»¶æ ¼å¼è¯´æ˜

| æ–‡ä»¶ç±»å‹   | å†…å®¹                    | è¯´æ˜     |
| ------ | --------------------- | ------ |
| `.wav` | åŸå§‹éŸ³é¢‘æ³¢å½¢                | è¾“å…¥æ–‡ä»¶   |
| `.npy` | CQTé¢‘è°±çŸ©é˜µ (numpy array) | ç½‘ç»œè¾“å…¥ç‰¹å¾ |
| `.pth` | è®­ç»ƒåçš„PyTorchæ¨¡å‹å‚æ•°       | æ¨¡å‹è¾“å‡º   |
| `.png` | é¢‘è°±å›¾å¯è§†åŒ–                | å¯è§†åŒ–ç»“æœ  |

---

## ğŸ§  é™„æ³¨

* è‹¥è¦ä½¿ç”¨ Mel è°±æ›¿ä»£ CQTï¼Œåªéœ€ä¿®æ”¹ `preprocess_snore.py`ï¼š

  ```python
  librosa.feature.melspectrogram(y=y, sr=sr, n_mels=128)
  ```
* è‹¥è¦é™ä½é‡‡æ ·ç‡ä»¥åŠ å¿«å¤„ç†ï¼Œå¯æ”¹ä¸ºï¼š

  ```python
  sr = 16000
  ```

---

## âœ¨ è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒè®ºæ–‡ï¼š

> Xie, B., Long, X., Arends, J. B., et al.
> *Audio-based snore detection using deep neural networks.*
> Computer Methods and Programs in Biomedicine, 2021.

---

ğŸ“ **ä½œè€…ï¼š** å¼ é›¯æ—­
ğŸ“… **æ›´æ–°æ—¶é—´ï¼š** 2025å¹´10æœˆ


